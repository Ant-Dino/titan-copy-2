import React, { useEffect, useState } from 'react';
import axios from 'axios';
import { useCookies } from 'react-cookie';

interface UserInfo {
  UserName: string;
  ActivityRight: string;
  CanManageTEQ: boolean;
  CanManageBEQ: boolean;
  CanAccessReq: boolean;
}

interface IProps {}

const TowerComponent: React.FC<IProps> = () => {
  const [userInfo, setUserInfo] = useState<UserInfo | null>(null);
  const [tenantName, setTenantName] = useState<string>('');
  const [errors, setErrors] = useState<{ unauthorized?: string }>({});
  const [, setCookie, removeCookie] = useCookies(['browsercheck', 'currentuser', 'activityright', 'CanAccessReq', 'tenantname']);

  useEffect(() => {
    const getUserInfo = async () => {
      try {
        const response = await axios.get('Security/GetCurrentUser/');
        setUserInfo(response.data);
        setCookie('currentuser', response.data.UserName);
        setCookie('activityright', response.data.ActivityRight);
        setCookie('CanAccessReq', response.data.CanAccessReq);
      } catch (error) {
        setErrors({ unauthorized: "You are not authorized to access this application." });
      }
    };

    const getTenantName = async () => {
      try {
        const response = await axios.get('Security/GetTenant/');
        setTenantName(response.data);
        setCookie('tenantname', response.data);
      } catch (error) {
        console.error("Failed to fetch tenant name", error);
      }
    };

    getUserInfo();
    getTenantName();
  }, [setCookie]);

  const openPopupWindow = () => {
    window.open("./TowerUserGuide/help.html", "User Guide", "scrollbars=1,resizable=1,left=10,top=150");
  };

  return (
    <div className="container-fluid">
      {errors.unauthorized ? (
        <div className="alert alert-danger">
          <div className="error"><i className="fa fa-lg fa-ban"></i> {errors.unauthorized}</div>
        </div>
      ) : (
        <div>
          <div>
            {/* Here should be a replaced JSX based on the AngularJS `ps-framework` directive and its child */}
            {/* components, since those are specific to AngularJS and need to be rewritten in React. */}
            {/* You may need to use React context, and/or props for passing state (e.g., `currentUser`, `tenantName`) */}
            {/* down to child components. */}
          </div>
        </div>
      )}
    </div>
  );
};

export default TowerComponent;